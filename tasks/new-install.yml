---
- hosts: all

  become: yes
  tasks:
    - name: update apt packages
      apt:
        upgrade: yes
        update_cache: yes
        autoclean: yes
        autoremove: yes
        
    - name: htop | wget | curl | sudo | neofetch
      apt:
        name: 
          - htop
          - wget
          - curl
          - sudo
          - neofetch
        state: present
        update_cache: true
      become: true
      
    - name: base | neofetch | add to motd
      shell: echo "echo" > /etc/profile.d/mymotd.sh && echo "neofetch" >> /etc/profile.d/mymotd.sh && chmod +x /etc/profile.d/mymotd.sh   
      
    - name: base | add user | {{ newuser_username }}
      user:
        name: "{{ newuser_username }}"
        comment: "{{ newuser_comment }}"
        group: "{{ newuser_group }}"
        password: "{{ 'newuser_password' | password_hash('sha512') }}"
        shell: /bin/bash
    - name: Create the .ssh directory
      file:
        path: "~/.ssh"
        state: directory
      become: true
      become_method: sudo
      become_user: "{{ newuser_username }}"
      
    - name: Set authorized keys taken from url
      ansible.posix.authorized_key:
        user: "{{ newuser_username }}"
        state: present
        key: "{{ newuser_rsakeys }}"
  
    - name: Set timezone to {{ newserver_tz }}
      timezone:
        name: "{{ newserver_tz }}"
