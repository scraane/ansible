---
- hosts: source

  become: yes
  tasks:

  - name: register the first file
    stat:
      path: "{{ ssl_cert_current_location }}/cert.pem"
      checksum: sha1
      get_checksum: yes
    register: file_1
  
  - name: register the second file
    stat:
      path: "{{ ssl_cert_archive_location }}/cert.pem"
      checksum: sha1
      get_checksum: yes
    register: file_2

  - name: Check if the files are the same
    fail: 
      set_fact: file_same="true"
      debug: msg="The {{ ssl_cert_current_location }}/cert.pem and {{ ssl_cert_archive_location }}/cert.pem are identical"
    when: file_1.stat.checksum == file_2.stat.checksum

  - meta: end_play
    when: file_same == "true"

- hosts: target

  become: yes
  tasks:
    - name: Going through all targets
      shell: "ls"
      when: file_changed == "true"
